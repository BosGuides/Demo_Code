<!-- 当前文档为获取构件组几何信息示例代码 -->

<!DOCTYPE html> 
 <html> 
     <head> 
         <title>ComsGeoData</title> 
         <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
         <link rel="stylesheet" href="http://www.boswinner.com.cn/vizbim/BIMWINNER.viewer.min.css" /> 
     </head> 
     <body> 
         <div id="viewport" style="width: 800px; height: 600px;"></div> 

         <script type="text/javascript" src="http://www.boswinner.com.cn/vizbim/jquery.min.js"></script> 
         <script type="text/javascript" src="http://www.boswinner.com.cn/vizbim/bootstrap-treeview.min.js"></script> 
         <script type="text/javascript" src="http://www.boswinner.com.cn/vizbim/spectrum.js"></script> 
         <script type="text/javascript" src="http://www.boswinner.com.cn/vizbim/jquery-ui.js"></script> 
         <script type="text/javascript" src="http://www.boswinner.com.cn/vizbim/three.min.js"></script> 
         <script type="text/javascript" src="http://www.boswinner.com.cn/vizbim/jszip.min.js"></script> 
         <script type="text/javascript" src="http://www.boswinner.com.cn/vizbim/BIMWINNER.viewer.min.js"></script> 

         <script type="text/javascript"> 
             //配置文件KEY 
             //获取文件KEY请前往“我的模型/个人中心-->我的模型”，http://www.boswinner.com.cn/mymodel 
             var filekey = "demo_fornature_cover"; 
             var op = { 
                 viewport:"viewport", //画布容器 
                 //配置开发密钥 
                 //获取开发密钥请前往“个人中心-->个人资料”，http://www.boswinner.com.cn/userpersonal 
                 devcode:"e10e59bf0ee97213ca7104977877bd1a", 
             }; 
             //1.创建三维浏览器对象 
             var vizbim = new BIMWINNER.Viewer(op); 
             //2.添加工具条 
             var tool = new BIMWINNER.Tool(vizbim); 
             tool.createTool(); 
             //3.加载模型 
             vizbim.showModelByDocumentId(filekey,function(){ 
                //定义获取构件组几何信息接口的地址
                var url_step2 = "http://api.boswinner.com.cn/components/geometry?devcode=e10e59bf0ee97213ca7104977877bd1a";
                //定义获取构件组几何信息的函数，作为获取某类构件中构件列表后的回调函数
                var getGeo = function(url, componentList){
                        $.ajax({
                           method: 'POST',
                           url: url_step2,
                           contentType: "application/json",
                           data: JSON.stringify(componentList)
                        })
                       .done(function(geodata){
                           console.log(geodata);
                       });
                }

                //选择一个当前模型含有的构件类型。
                //以“IfcFurnishingElement”为例
                //来获取对应的构件列表
                //POST:
                //models/{fileKey}/components?devcode='UserDevcode'
                var url_step1="http://api.boswinner.com.cn/models/demo_fornature_cover/components?devcode=e10e59bf0ee97213ca7104977877bd1a";
                var data_step1 = ["IfcFurnishingElement"];
                $.ajax({
                    type: 'POST',
                    url: url_step1,
                    contentType: "application/json",
                    data: JSON.stringify(data_step1)
                    })
                .done(function(componentList){
                    //返回的信息将在console里显示出来
                    console.log(componentList["data"]);
                    //将生成的构件列表传入获取几何信息的接口中，以获取构件几何信息
                    getGeo(url_step2,componentList["data"]);
                });


                //为方便查看被提取数据的构件
                //用如下代码将被提取数据的构件高亮显示出来

                //step1: 获取当前模型所有构件类型列表
                var objsTypeArray = vizbim.getComponentTypeArray();

                //step2: 选取某一类构件进行操作，此处以‘IfcFurnishingElement’为例
                var selectedType = objsTypeArray['IfcFurnishingElement'];

                //step3: 隔离当前所选构件组
                vizbim.highlightObjs(selectedType);

                }); 
             //4.设置全屏显示 
             vizbim.autoResize=true; 
             vizbim.resize(); 
         </script> 
     </body> 
     

 </html>
